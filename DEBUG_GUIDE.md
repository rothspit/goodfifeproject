# ログイン問題デバッグガイド

## 🔍 コンソールログを確認する方法

### 方法1: コンソールログの保持設定（推奨）

ブラウザの設定を変更して、ページ遷移後もログを保持します。

**Chrome/Edge:**
1. F12で開発者ツールを開く
2. Consoleタブをクリック
3. 右上の⚙️（設定アイコン）をクリック
4. "Preserve log"（ログを保持）にチェックを入れる

**Firefox:**
1. F12で開発者ツールを開く
2. Consoleタブをクリック
3. 右上の⚙️（設定）をクリック
4. "Persist Logs"にチェックを入れる

**Safari:**
1. Command + Option + C で開発者ツールを開く
2. Consoleタブをクリック
3. "Preserve Log"にチェックを入れる

### 方法2: 確認ダイアログを使用（簡単）

現在の実装では、ログイン成功後に確認ダイアログが表示されます：

1. ログイン実行
2. 確認ダイアログが表示される
3. **「キャンセル」をクリック**
4. ページに留まる
5. F12でコンソールログを確認

### 方法3: Network Throttlingで遅延

1. F12で開発者ツールを開く
2. Networkタブをクリック
3. "No throttling" を "Slow 3G"に変更
4. ログインを実行（処理が遅くなる）
5. その間にConsoleタブを確認

## 📊 確認すべき情報

### ログイン時のコンソールログ

以下のログが表示されるはずです：

```
ログイン成功: {message: "ログインしました", token: "...", user: {...}}
トークン: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
ユーザー情報: {id: 2, phone_number: "09069496686", ...}
✅ ストレージへの保存完了
localStorage確認（1回目）: {token: "保存OK", user: "保存OK"}
localStorage確認（2回目）: {localStorage_token: "OK", ...}
✅ マイページへリダイレクト
```

### ストレージの状態確認

**Application/Storageタブ:**
1. F12で開発者ツールを開く
2. Applicationタブ（ChromeまたはEdge）またはStorageタブ（Firefox）をクリック
3. Local Storage → https://3002-iwlhxuzhfaqbr3cqpityv-b32ec7bb.sandbox.novita.ai
4. 以下のキーが存在するか確認：
   - `token`: JWT文字列
   - `user`: JSONオブジェクト
5. Session Storageも同様に確認

## 🐛 よくある問題と解決策

### 問題1: localStorageに保存されない

**原因:**
- プライベート/シークレットモード
- ブラウザ拡張機能（広告ブロッカー、プライバシー保護）
- ブラウザのストレージ設定が無効

**解決策:**
1. 通常モードでブラウザを開く
2. 拡張機能を一時的に無効化
3. ブラウザの設定でCookieとストレージを有効化

### 問題2: ページ遷移でlocalStorageが消える

**原因:**
- ブラウザのセキュリティ設定
- サードパーティCookieのブロック
- ドメイン/サブドメインの違い

**解決策:**
- 現在の実装ではsessionStorageもフォールバックとして使用
- それでも問題が続く場合はCookie認証への移行を検討

### 問題3: 確認ダイアログが表示されない

**原因:**
- ログインAPIがエラーを返している
- ネットワークエラー

**確認方法:**
1. Networkタブを開く
2. `/api/auth/login`のリクエストを確認
3. Statusが200か確認
4. Responseの内容を確認

## 🧪 テストアカウント

- 電話番号: `09069496686`
- パスワード: `111111`

## 📞 サポート情報

問題が解決しない場合、以下の情報を提供してください：

1. ブラウザの種類とバージョン
2. コンソールログのスクリーンショット
3. Application/StorageタブのLocal Storageスクリーンショット
4. 確認ダイアログに表示されたストレージ状態
5. Networkタブの`/api/auth/login`レスポンス
