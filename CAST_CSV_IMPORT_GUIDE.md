# 女性キャストCSVインポート機能ガイド

## 概要
女性キャストのプロフィール情報（20項目）をCSVファイルから一括インポートする機能です。
GoogleスプレッドシートとCSVファイルの両方に対応しています。

## アクセス方法
- **管理画面URL**: https://crm.h-mitsu.com/admin
- **メニュー**: 「女性取り込み」

## インポート方法の選択

### 1. CSVファイル（推奨）
- 最もシンプルで高速
- オフラインでの編集が可能
- ExcelやGoogleスプレッドシートで編集可能
- テンプレートダウンロード機能あり

### 2. Googleスプレッドシート
- 複数人でのリアルタイム編集が可能
- Google API Key設定が必要

## CSVファイル形式

### ヘッダー行（必須）
以下の20項目を正確にCSVの1行目に記載してください：

```csv
名前,ひらがな,ローマ字,生年月日,年齢,入店日,身長,バスト,カップ,ウェスト,ヒップ,キャッチコピー10文字,キャッチコピー20文字,スタイル,タイプ,お酒,タバコ,新人,お店コメント,女の子コメント
```

### データ行
2行目以降にキャストのデータを入力します。

#### 例
```csv
名前,ひらがな,ローマ字,生年月日,年齢,入店日,身長,バスト,カップ,ウェスト,ヒップ,キャッチコピー10文字,キャッチコピー20文字,スタイル,タイプ,お酒,タバコ,新人,お店コメント,女の子コメント
山田花子,やまだはなこ,yamada hanako,1998-05-15,26,2024-01-10,160,85,C,58,86,笑顔が素敵,いつも明るく元気です,スレンダー,癒し系,お酒好き,吸わない,0,とても優しい女の子です,よろしくお願いします
佐藤美咲,さとうみさき,sato misaki,1999-08-20,25,2024-02-15,165,88,D,60,87,愛嬌抜群,人懐っこい性格が魅力,グラマラス,明るい系,少し飲める,吸わない,1,明るくて元気な新人です,頑張ります！
```

## 項目詳細

| 項目名 | データ型 | 必須 | 説明 | 例 |
|--------|---------|------|------|-----|
| 名前 | 文字列 | ✅ | キャストの名前 | 山田花子 |
| ひらがな | 文字列 | | 名前のひらがな表記 | やまだはなこ |
| ローマ字 | 文字列 | | 名前のローマ字表記 | yamada hanako |
| 生年月日 | 日付 | | YYYY-MM-DD形式 | 1998-05-15 |
| 年齢 | 数値 | | 年齢 | 26 |
| 入店日 | 日付 | | YYYY-MM-DD形式 | 2024-01-10 |
| 身長 | 数値 | | cm単位 | 160 |
| バスト | 文字列 | | サイズ | 85 |
| カップ | 文字列 | | カップサイズ | C |
| ウェスト | 数値 | | cm単位 | 58 |
| ヒップ | 数値 | | cm単位 | 86 |
| キャッチコピー10文字 | 文字列 | | 10文字程度のキャッチコピー | 笑顔が素敵 |
| キャッチコピー20文字 | 文字列 | | 20文字程度のキャッチコピー | いつも明るく元気です |
| スタイル | 文字列 | | 体型タイプ | スレンダー、グラマラス、など |
| タイプ | 文字列 | | 性格タイプ | 癒し系、明るい系、など |
| お酒 | 文字列 | | 飲酒状況 | お酒好き、少し飲める、飲めない |
| タバコ | 文字列 | | 喫煙状況 | 吸わない、吸う |
| 新人 | 数値/文字列 | | 新人フラグ | 1, 0, ○, 新人 |
| お店コメント | 文字列 | | お店からのコメント | とても優しい女の子です |
| 女の子コメント | 文字列 | | 女の子からのコメント | よろしくお願いします |

### 注意事項
1. **文字エンコーディング**: UTF-8を推奨
2. **日付形式**: YYYY-MM-DD（例: 2024-01-10）
3. **数値**: 半角数字のみ
4. **新人フラグ**: 以下のいずれかを使用
   - `1` = 新人
   - `0` = 既存
   - `○` = 新人
   - `新人` = 新人
   - 空欄 = 既存

## 使用手順

### ステップ1: CSVファイル準備

#### 方法A: テンプレートダウンロード
1. 管理画面の「女性取り込み」にアクセス
2. 「CSVファイル（推奨）」を選択
3. 「テンプレートダウンロード」ボタンをクリック
4. ダウンロードした `cast_import_template.csv` を編集

#### 方法B: 新規作成
1. Excelまたはテキストエディタで新規CSVファイルを作成
2. 1行目にヘッダー行を記入
3. 2行目以降にデータを入力
4. UTF-8エンコーディングで保存

### ステップ2: データ入力
1. CSVファイルにキャストデータを入力
2. 必須項目（名前）は必ず入力
3. その他の項目は任意

### ステップ3: アップロード
1. 管理画面で「ファイルを選択」をクリック
2. 準備したCSVファイルを選択
3. 「CSVファイルを読み込む」ボタンをクリック

### ステップ4: プレビュー確認
1. データが正しく読み込まれたか確認
2. 件数とデータ内容をチェック
3. 詳細プレビューで1件目のデータを確認

### ステップ5: インポート実行
1. 「データベースにインポート」ボタンをクリック
2. 確認ダイアログで「OK」を選択
3. インポート完了を待つ

## データ更新について

### 既存キャストの更新
- **判定基準**: 名前が一致する場合
- **動作**: 既存データが新しいデータで上書きされます
- **例**: 「山田花子」というキャストが既に登録されている場合、同じ名前のデータをインポートすると既存データが更新されます

### 新規キャストの登録
- **判定基準**: 名前が一致しない場合
- **動作**: 新しいキャストとして登録されます

## トラブルシューティング

### エラー: 「CSVファイルが必要です」
- **原因**: ファイルが選択されていない
- **対処**: CSVファイルを選択してから実行

### エラー: 「CSVの解析に失敗しました」
- **原因**: CSVファイルの形式が正しくない
- **対処**:
  1. UTF-8エンコーディングで保存されているか確認
  2. ヘッダー行が正しく記載されているか確認
  3. 余分な空行や特殊文字がないか確認

### エラー: 「名前が必要です」
- **原因**: 名前フィールドが空
- **対処**: 全てのデータ行に名前を入力

### データが正しく表示されない
- **原因**: 文字エンコーディングの問題
- **対処**:
  1. ファイルをUTF-8で再保存
  2. Excelで開いた場合、「CSV UTF-8」形式で保存

## Excel での CSV 作成手順

### Excelでの作業
1. 新規ブックを作成
2. 1行目にヘッダーを入力
3. 2行目以降にデータを入力
4. 「ファイル」→「名前を付けて保存」
5. ファイル形式: **CSV UTF-8 (コンマ区切り) (.csv)**
6. 保存

### 注意点
- 通常の「CSV (コンマ区切り) (.csv)」ではなく、**「CSV UTF-8」**を選択してください
- Excelで開き直すと文字化けする場合がありますが、アップロード時は正常に動作します

## Googleスプレッドシートでの作成

1. Googleスプレッドシートで新規シート作成
2. 1行目にヘッダーを入力
3. 2行目以降にデータを入力
4. 「ファイル」→「ダウンロード」→「カンマ区切り形式 (.csv)」
5. ダウンロードしたファイルをアップロード

## 一括更新の活用例

### シナリオ1: 年齢の一括更新
誕生日を迎えたキャストの年齢を一括で更新したい場合：
1. 現在のキャストデータをエクスポート（別途実装予定）
2. CSVファイルで年齢を更新
3. インポートして上書き

### シナリオ2: 新人フラグの一括解除
新人期間が終了したキャストの新人フラグを解除：
1. 該当キャストのCSVを作成
2. 新人フィールドを「0」に設定
3. インポートして更新

### シナリオ3: 大量の新規キャスト登録
複数の新規キャストを一度に登録：
1. CSVファイルに全員のデータを入力
2. 一度のインポートで全員登録完了

## APIエンドポイント（開発者向け）

### CSV アップロード
```
POST /api/cast-import/upload-csv
Content-Type: multipart/form-data
Authorization: Bearer <token>

Body:
- csv: File (CSVファイル)

Response:
{
  "success": true,
  "data": [CastData[]],
  "count": number
}
```

### データインポート
```
POST /api/cast-import/import
Content-Type: application/json
Authorization: Bearer <token>

Body:
{
  "casts": [CastData[]]
}

Response:
{
  "success": true,
  "message": "10件のキャストをインポートしました",
  "imported": 10,
  "errors": []
}
```

## セキュリティ

- ✅ 認証必須: 管理者のみアクセス可能
- ✅ ファイルサイズ制限: サーバー側で制限あり
- ✅ 一時ファイル: アップロード後自動削除
- ✅ トランザクション: データ整合性を保証

## パフォーマンス

- **推奨件数**: 1回のインポートで最大100件
- **処理時間**: 100件で約5-10秒
- **大量データ**: 100件以上の場合は分割してインポート推奨

## 今後の機能拡張予定

- [ ] キャストデータのCSVエクスポート機能
- [ ] インポート履歴の記録
- [ ] エラー行のハイライト表示
- [ ] 画像の一括アップロード対応
- [ ] バッチ処理による大量データインポート

## サポート

問題が発生した場合は、以下の情報を添えてお問い合わせください：
1. エラーメッセージのスクリーンショット
2. 使用したCSVファイル（サンプル）
3. 発生した状況の詳細

---

**作成日**: 2025年12月15日  
**バージョン**: 1.0  
**対応システム**: goodfifeproject CRM
