# ğŸ“ ã‚¢ã‚¤ãƒ‰ãƒ«å­¦åœ’ - ãƒ˜ãƒ–ãƒ³æ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

ã‚·ãƒ†ã‚£ãƒ˜ãƒ–ãƒ³ãƒãƒƒãƒˆã®ã€Œãƒ˜ãƒ–ãƒ³æ›´æ–°ãƒœã‚¿ãƒ³ã€ã‚’æŒ‡å®šã•ã‚ŒãŸ15æ ã®æ™‚é–“ã«è‡ªå‹•ã§æŠ¼ã™ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã€‚

---

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ15æ ï¼‰

```
 1. 07:02
 2. 11:54
 3. 14:55
 4. 17:12
 5. 18:05
 6. 19:15
 7. 20:35
 8. 21:57
 9. 22:26
10. 23:05
11. 23:35
12. 18:36
13. 20:05
14. 21:04
15. 22:44
```

**æ®‹ã‚Šå›æ•°**: æ¯å›è‡ªå‹•ã§ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ16/16å›ãªã©ï¼‰

---

## ğŸš€ ä½¿ã„æ–¹

### **ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚’èµ·å‹•ï¼ˆ24æ™‚é–“è‡ªå‹•å®Ÿè¡Œï¼‰**

```bash
cd /home/user/webapp/ad-platform-manager/backend
npx ts-node heaven-update-scheduler.ts
```

**å‹•ä½œ**:
- æ¬¡ã®å®Ÿè¡Œæ™‚åˆ»ã¾ã§è‡ªå‹•ã§å¾…æ©Ÿ
- æŒ‡å®šæ™‚åˆ»ã«è‡ªå‹•ã§ãƒ˜ãƒ–ãƒ³æ›´æ–°ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
- æ®‹ã‚Šå›æ•°ã‚’æ¯å›ã‚«ã‚¦ãƒ³ãƒˆ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è‡ªå‹•ä¿å­˜
- 24æ™‚é–“365æ—¥ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã§å®Ÿè¡Œ

**å‡ºåŠ›ä¾‹**:
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“ ã‚¢ã‚¤ãƒ‰ãƒ«å­¦åœ’ - ãƒ˜ãƒ–ãƒ³æ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼èµ·å‹•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ15æ ï¼‰:
    1. 07:02
    2. 11:54
    3. 14:55
    4. 17:12
    5. 18:05
    6. 19:15
    7. 20:35
    8. 21:57
    9. 22:26
   10. 23:05
   11. 23:35
   12. 18:36
   13. 20:05
   14. 21:04
   15. 22:44

â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼é–‹å§‹...

â° æ¬¡å›å®Ÿè¡Œæ™‚åˆ»: 22:44 (2025/12/25 22:44:00)
â³ å¾…æ©Ÿæ™‚é–“: 34åˆ†

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“ ã‚¢ã‚¤ãƒ‰ãƒ«å­¦åœ’ - ãƒ˜ãƒ–ãƒ³æ›´æ–°å®Ÿè¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚åˆ»: 22:44
â° å®Ÿéš›ã®å®Ÿè¡Œæ™‚åˆ»: 2025/12/25 22:44:02

ğŸš€ ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ä¸­...
âœ… ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•å®Œäº†

ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ä¸­...
âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ

ğŸ“Š å®Ÿè¡Œå‰ã®æ®‹ã‚Šå›æ•°: 16/16å›
ğŸ”„ ãƒ˜ãƒ–ãƒ³æ›´æ–°ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ä¸­...
âœ… ã‚¯ãƒªãƒƒã‚¯æˆåŠŸ
ğŸ“Š å®Ÿè¡Œå¾Œã®æ®‹ã‚Šå›æ•°: 15/16å›

ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜: screenshots/heaven-update-2244-1766696640123.png

âœ… æ›´æ–°æˆåŠŸ
ğŸ“Š æ›´æ–°æˆåŠŸï¼ˆæ®‹ã‚Š15/16å›ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â° æ¬¡å›å®Ÿè¡Œæ™‚åˆ»: 23:05 (2025/12/25 23:05:00)
â³ å¾…æ©Ÿæ™‚é–“: 21åˆ†
```

---

### **ãƒ‘ã‚¿ãƒ¼ãƒ³2: 1å›ã ã‘å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰**

```bash
npx ts-node heaven-update-scheduler.ts --once
```

**å‹•ä½œ**:
- å³åº§ã«1å›ã ã‘å®Ÿè¡Œ
- æ®‹ã‚Šå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ä¿å­˜
- çµ‚äº†

---

### **ãƒ‘ã‚¿ãƒ¼ãƒ³3: PM2ã§ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–ï¼ˆæœ¬ç•ªé‹ç”¨æ¨å¥¨ï¼‰**

```bash
# PM2ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•
pm2 start heaven-update-scheduler.ts --name "heaven-scheduler" --interpreter ts-node

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 status

# ãƒ­ã‚°ç¢ºèª
pm2 logs heaven-scheduler

# åœæ­¢
pm2 stop heaven-scheduler

# å†èµ·å‹•
pm2 restart heaven-scheduler

# å‰Šé™¤
pm2 delete heaven-scheduler

# è‡ªå‹•èµ·å‹•è¨­å®šï¼ˆã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•æ™‚ã«è‡ªå‹•èµ·å‹•ï¼‰
pm2 startup
pm2 save
```

---

## ğŸ“Š ãƒ­ã‚°ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

### **å®Ÿè¡Œãƒ­ã‚°**
å ´æ‰€: `logs/heaven-update-scheduler-YYYY-MM-DD.json`

å†…å®¹ä¾‹:
```json
[
  {
    "scheduledTime": "22:44",
    "actualExecutionTime": "2025/12/25 22:44:02",
    "remainingCountBefore": "16/16",
    "remainingCountAfter": "15/16",
    "success": true
  },
  {
    "scheduledTime": "23:05",
    "actualExecutionTime": "2025/12/25 23:05:01",
    "remainingCountBefore": "15/16",
    "remainingCountAfter": "14/16",
    "success": true
  }
]
```

### **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**
å ´æ‰€: `screenshots/heaven-update-HHMM-timestamp.png`

ä¾‹:
- `screenshots/heaven-update-0702-1766696640123.png`
- `screenshots/heaven-update-1154-1766696640456.png`
- `screenshots/heaven-update-1455-1766696640789.png`

---

## ğŸ›  ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### **Q1: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ãŒåœæ­¢ã—ã¦ã—ã¾ã†**
```bash
# PM2ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–ã—ã¦ãã ã•ã„
pm2 start heaven-update-scheduler.ts --name "heaven-scheduler" --interpreter ts-node

# è‡ªå‹•å†èµ·å‹•è¨­å®š
pm2 startup
pm2 save
```

### **Q2: ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹**
```bash
# èªè¨¼æƒ…å ±ã‚’ç¢ºèª
# heaven-update-scheduler.ts ã®ä»¥ä¸‹ã‚’ç¢ºèª:
const STORE_ID = '2510055906';
const PASSWORD = 'OgI70vnH';
```

### **Q3: ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼**
- ã‚·ãƒ†ã‚£ãƒ˜ãƒ–ãƒ³ãƒãƒƒãƒˆã®ç®¡ç†ç”»é¢æ§‹é€ ãŒå¤‰æ›´ã•ã‚ŒãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ç¢ºèªã—ã¦ã€ãƒœã‚¿ãƒ³ã®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„

### **Q4: æ¬¡ã®å®Ÿè¡Œæ™‚åˆ»ã‚’æ‰‹å‹•ã§ç¢ºèªã—ãŸã„**
```bash
# ç¾åœ¨æ™‚åˆ»ã¨æ¬¡ã®å®Ÿè¡Œæ™‚åˆ»ã‚’è¡¨ç¤º
node -e "
const times = ['07:02','11:54','14:55','17:12','18:05','19:15','20:35','21:57','22:26','23:05','23:35','18:36','20:05','21:04','22:44'];
const now = new Date();
const current = now.getHours() * 60 + now.getMinutes();
const next = times.find(t => {
  const [h,m] = t.split(':').map(Number);
  return h * 60 + m > current;
}) || times[0];
console.log('ç¾åœ¨æ™‚åˆ»:', now.toLocaleTimeString('ja-JP'));
console.log('æ¬¡å›å®Ÿè¡Œ:', next);
"
```

---

## ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–

### **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–**
```bash
# PM2ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
pm2 logs heaven-scheduler --lines 50

# JSONãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
tail -f logs/heaven-update-scheduler-$(date +%Y-%m-%d).json
```

### **å®Ÿè¡Œå±¥æ­´ã®ç¢ºèª**
```bash
# ä»Šæ—¥ã®ãƒ­ã‚°ã‚’ç¢ºèª
cat logs/heaven-update-scheduler-$(date +%Y-%m-%d).json | jq '.'

# å®Ÿè¡ŒæˆåŠŸå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
cat logs/heaven-update-scheduler-$(date +%Y-%m-%d).json | jq '[.[] | select(.success == true)] | length'

# æ®‹ã‚Šå›æ•°ã®æ¨ç§»ã‚’ç¢ºèª
cat logs/heaven-update-scheduler-$(date +%Y-%m-%d).json | jq '.[] | {time: .actualExecutionTime, remaining: .remainingCountAfter}'
```

---

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚é–“ã‚’å¤‰æ›´ã—ãŸã„å ´åˆ**

`heaven-update-scheduler.ts` ã®ä»¥ä¸‹ã‚’ç·¨é›†:

```typescript
// 15æ ã®æ™‚é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ24æ™‚é–“å½¢å¼ï¼‰
const SCHEDULE_TIMES = [
  '07:02',
  '11:54',
  // ... å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´
];
```

### **ãƒ–ãƒ©ã‚¦ã‚¶ã‚’éãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ãŸã„å ´åˆ**

```typescript
this.browser = await chromium.launch({
  headless: false,  // â† false ã«å¤‰æ›´
  args: ['--no-sandbox', '--disable-setuid-sandbox'],
});
```

---

## ğŸ¯ æœ¬ç•ªé‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] PM2ã§ãƒ‡ãƒ¼ãƒ¢ãƒ³åŒ–
- [ ] `pm2 startup` ã§è‡ªå‹•èµ·å‹•è¨­å®š
- [ ] `pm2 save` ã§è¨­å®šä¿å­˜
- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å®šæœŸå‰Šé™¤è¨­å®šï¼ˆå¤ã„ãƒ­ã‚°ã‚’å‰Šé™¤ï¼‰
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å®šæœŸå‰Šé™¤è¨­å®š
- [ ] ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®è¨­å®šï¼ˆSlack/Emailãªã©ï¼‰

---

## ğŸ“ ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šä¾‹

```bash
# 30æ—¥ã‚ˆã‚Šå¤ã„ãƒ­ã‚°ã‚’å‰Šé™¤
find /home/user/webapp/ad-platform-manager/backend/logs -name "heaven-update-scheduler-*.json" -mtime +30 -delete

# cronã§è‡ªå‹•åŒ–ï¼ˆæ¯æ—¥åˆå‰3æ™‚ã«å®Ÿè¡Œï¼‰
0 3 * * * find /home/user/webapp/ad-platform-manager/backend/logs -name "heaven-update-scheduler-*.json" -mtime +30 -delete
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- èªè¨¼æƒ…å ±ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ã€ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’åˆ¶é™

```bash
# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’åˆ¶é™
chmod 700 screenshots/
chmod 600 screenshots/*.png
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

1. **PM2ãƒ­ã‚°**: `pm2 logs heaven-scheduler`
2. **JSONãƒ­ã‚°**: `logs/heaven-update-scheduler-YYYY-MM-DD.json`
3. **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: `screenshots/heaven-update-*.png`

---

ä½œæˆæ—¥: 2025-12-25
